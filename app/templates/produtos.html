<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos - Sistema Donnatureza</title>
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <img src="/static/img/DonnaturezaLogo.png" alt="Donnatureza" class="logo">
                    <div class="header-text">
                        <h1>Sistema Donnatureza</h1>
                    </div>
                </div>
                <nav class="header-nav">
                    <a href="/">In√≠cio</a>
                    <a href="/produtos" class="active">Produtos</a>
                    <a href="/vendas">Vendas</a>
                    <a href="/catalogo">Cat√°logo</a>
                    <a href="/estoque">Estoque</a>
                    <a href="/relatorios">Relat√≥rios</a>
                </nav>
            </div>
        </header>
        
        <main>
            <h2>Gerenciar Produtos</h2>
            
            <div class="actions">
                <button id="btnNovoProduto" class="btn-primary" onclick="showNewProductForm()">Novo Produto</button>
                <input type="text" id="searchProduto" placeholder="Buscar produto...">
            </div>
            
            <div id="produtoForm" class="form-container" style="display: none;">
                <h3 id="formTitle">Novo Produto</h3>
                <form id="formProduto">
                    <input type="hidden" id="produtoId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome">Nome:</label>
                            <input type="text" id="nome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="codigo_barras">C√≥digo de Barras:</label>
                            <div class="barcode-input-group">
                                <input type="text" id="codigo_barras" placeholder="Digite ou escaneie o c√≥digo">
                                <button type="button" class="btn-barcode" onclick="openBarcodeScanner()" title="Escanear c√≥digo de barras">
                                    üì± Escanear
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="preco">Pre√ßo:</label>
                            <input type="number" id="preco" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="estoque">Estoque:</label>
                            <input type="number" id="estoque" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categoria">Categoria:</label>
                            <input type="text" id="categoria">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="descricao">Descri√ß√£o:</label>
                        <textarea id="descricao" rows="3"></textarea>
                    </div>
                    
                    <h4>Informa√ß√µes Fiscais</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ncm">NCM:</label>
                            <input type="text" id="ncm" placeholder="00000000" maxlength="8" required>
                            <small>Nomenclatura Comum do Mercosul</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="cfop">CFOP:</label>
                            <input type="text" id="cfop" value="5102" maxlength="4" required>
                            <small>C√≥digo Fiscal de Opera√ß√µes</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unidade_medida">Unidade:</label>
                            <select id="unidade_medida" required>
                                <option value="UN">Unidade (UN)</option>
                                <option value="KG">Quilograma (KG)</option>
                                <option value="L">Litro (L)</option>
                                <option value="M">Metro (M)</option>
                                <option value="M2">Metro Quadrado (M2)</option>
                                <option value="M3">Metro C√∫bico (M3)</option>
                                <option value="PC">Pe√ßa (PC)</option>
                                <option value="CX">Caixa (CX)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="origem">Origem:</label>
                            <select id="origem" required>
                                <option value="0">Nacional</option>
                                <option value="1">Estrangeiro - Importa√ß√£o direta</option>
                                <option value="2">Estrangeiro - Mercado interno</option>
                            </select>
                        </div>
                    </div>
                    
                    <h5>Tributa√ß√£o ICMS</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cst_icms">CST ICMS:</label>
                            <select id="cst_icms" required>
                                <option value="102">102 - Simples Nacional sem permiss√£o</option>
                                <option value="103">103 - Isen√ß√£o do ICMS</option>
                                <option value="300">300 - Imune</option>
                                <option value="400">400 - N√£o tributada</option>
                                <option value="500">500 - ICMS cobrado anteriormente</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="aliquota_icms">Al√≠quota ICMS (%):</label>
                            <input type="number" id="aliquota_icms" step="0.01" min="0" max="100" value="0.00">
                        </div>
                    </div>
                    
                    <h5>Tributa√ß√£o PIS/COFINS</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cst_pis">CST PIS:</label>
                            <select id="cst_pis">
                                <option value="07">07 - Opera√ß√£o Isenta</option>
                                <option value="01">01 - Opera√ß√£o Tribut√°vel</option>
                                <option value="06">06 - Opera√ß√£o Tribut√°vel Al√≠quota Zero</option>
                                <option value="08">08 - Opera√ß√£o sem Incid√™ncia</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="aliquota_pis">Al√≠quota PIS (%):</label>
                            <input type="number" id="aliquota_pis" step="0.0001" min="0" max="100" value="0.0000">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cst_cofins">CST COFINS:</label>
                            <select id="cst_cofins">
                                <option value="07">07 - Opera√ß√£o Isenta</option>
                                <option value="01">01 - Opera√ß√£o Tribut√°vel</option>
                                <option value="06">06 - Opera√ß√£o Tribut√°vel Al√≠quota Zero</option>
                                <option value="08">08 - Opera√ß√£o sem Incid√™ncia</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="aliquota_cofins">Al√≠quota COFINS (%):</label>
                            <input type="number" id="aliquota_cofins" step="0.0001" min="0" max="100" value="0.0000">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cst_ipi">CST IPI (opcional):</label>
                            <select id="cst_ipi">
                                <option value="">N√£o se aplica</option>
                                <option value="00">00 - Entrada com recupera√ß√£o</option>
                                <option value="49">49 - Outras entradas</option>
                                <option value="50">50 - Sa√≠da tributada</option>
                                <option value="99">99 - Outras sa√≠das</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="aliquota_ipi">Al√≠quota IPI (%):</label>
                            <input type="number" id="aliquota_ipi" step="0.01" min="0" max="100" value="0.00">
                        </div>
                    </div>
                    
                    <div class="foto-section">
                        <div class="foto-preview">
                            <img id="fotoPreview" src="" alt="Foto do produto" style="display: none;">
                            <div id="fotoPlaceholder" class="foto-placeholder" onclick="showPhotoOptions()">
                                <span>üì∑</span>
                                <p>Clique para adicionar foto</p>
                            </div>
                        </div>
                        <div class="foto-controls">
                            <input type="file" id="fotoInputGaleria" accept="image/*" style="display: none;" onchange="handlePhotoSelection(this)">
                            <input type="file" id="fotoInputCamera" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoSelection(this)">
                            
                            <div class="photo-buttons">
                                <button type="button" id="btnGaleria" class="btn-secondary" onclick="selectFromGallery()" title="Selecionar arquivo de imagem">
                                    üñºÔ∏è Arquivo
                                </button>
                                <button type="button" id="btnCamera" class="btn-secondary" onclick="selectFromCamera()" title="Usar c√¢mera/webcam">
                                    üì∑ C√¢mera
                                </button>
                            </div>
                            
                            <button type="button" id="btnRemoverFoto" class="btn-secondary" style="display: none;" onclick="removePhoto()">
                                üóëÔ∏è Remover Foto
                            </button>
                            
                            <button type="button" id="btnCameraWebRTC" class="btn-secondary" onclick="openCameraModal()" style="display: none;">
                                üé• C√¢mera Avan√ßada
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Salvar</button>
                        <button type="button" id="btnCancelar" class="btn-secondary" onclick="hideProductForm()">Cancelar</button>
                    </div>
                </form>
            </div>
            
            <div class="table-container">
                <table id="tabelaProdutos">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Nome</th>
                            <th>C√≥digo</th>
                            <th>Pre√ßo</th>
                            <th>Estoque</th>
                            <th>Categoria</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>
    </div>
    
    <!-- Camera Modal -->
    <div id="cameraModal" class="camera-modal" style="display: none;">
        <div class="camera-modal-content">
            <div class="camera-header">
                <h3>C√¢mera</h3>
                <button class="camera-close" onclick="closeCameraModal()">&times;</button>
            </div>
            <div class="camera-body">
                <video id="cameraVideo" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
            </div>
            <div class="camera-controls">
                <button class="btn-primary" onclick="capturePhoto()">üì∑ Capturar</button>
                <button class="btn-secondary" onclick="closeCameraModal()">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!-- Barcode Scanner Modal -->
    <div id="barcodeModal" class="camera-modal" style="display: none;">
        <div class="camera-modal-content">
            <div class="camera-header">
                <h3>üì± Scanner de C√≥digo de Barras</h3>
                <button class="camera-close" onclick="closeBarcodeScanner()">&times;</button>
            </div>
            <div class="camera-body">
                <video id="barcodeVideo" autoplay playsinline></video>
                <div id="barcodeScanLine" class="scan-line"></div>
                <div class="scan-instructions">
                    <p>üìç Posicione o c√≥digo de barras na linha vermelha</p>
                    <p id="scanResult" class="scan-result" style="display: none;"></p>
                </div>
            </div>
            <div class="camera-controls">
                <button class="btn-secondary" onclick="closeBarcodeScanner()">Fechar</button>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/produtos.js"></script>
</body>
</html>